<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title></title>
		
		<link rel="stylesheet" href="style/syj.css" />
		
		<script src="js/jquery-1.10.2.min.js"></script>
	</head>
	<body>
		<div class="head" style="background:url(images/syj.png);background-size: 100% 100%;">
		  <div class="hwen">可兑换收益金</div>
		  <br />
		  <div class="hjin"><span id="zsyj"></span><span style="font-size: 0.4em;">&nbsp;元</span></div>
		<!--  <img src="images/lp.png" style="display:block;margin: auto;position: relative;top: 49px;" />-->
		  <div class="hdi">
		  	<div class="dil dizi">
		  		<span>总收益金</span><br />
		  		<span id="js"></span><span>&nbsp;元</span>
		  	</div>
		  	<div class="diz dizi">
		  		<span>已返还</span><br />
		  		<span id="yfh"></span><span>&nbsp;元</span>
		  	</div>
		  	<div class="dir dizi">
		  		<span>剩余应返还</span><br />
		  		<span id="sy"></span><span>&nbsp;元</span>
		  	</div>
		  </div>
		</div>
		<!--返还率 返还周期 每周返还-->
		<div class="zhong">
			<div class="zhongl">
				<span>返还率</span><br>
				<span>{$backrate}</span>
			</div>
			<div class="zhongl">
				<span>返还周期</span><br>
				<span>{$backmonth}<span style="font-size: 0.5em;">个月</span></span>
			</div>
			<div class="zhongl">
				<span>每周返还</span><br>
				<span id="mz"></span><span style="font-size: 0.5em;">元</span>	
			</div>	
		</div>
		<!--循环数据-->
         <div id="shuju">	
        <volist name="money_data" id="data">
			<div class="xun">
         		<div class="xunl">{$data.tran_date}</div>
         		<div class="xunl">已兑换</div>
         		<div class="xunr"><span class="xunrj">{$data.money}</span>元</div>
         	</div>
		</volist>
         	
         	
         	
         	
         	<!--<div class="xun">
         		<div class="xunl">2018-1-17</div>
         		<div class="xunl">已兑换</div>
         		<div class="xunr">1000元</div>
         	</div>-->
         </div>	
         	<div style="width: 100%;height: 150px;"></div>
	
		<div class="pingjia" style="background: url(images/anniu.png) no-repeat;background-size: 100% 60px;">
				<span >我要兑换</span>
			</div> 
		<!--底部菜单栏-->
		<div style="width: 100%;height: 57px;"></div>
		
		<div class="foot">
			<span class="foot_span">
				<a href="show.html">
				<img src="images/foot7.png" />
				<span>商城</span>
				</a>
			</span>
			<span class="foot_span">
				<a href="show1.html">
				<img src="images/foot2.png" />
				<span>票券</span>
				</a>
			</span>
			<span class="foot_span">
				<a href="myshop.html">
				<img src="images/foot3.png" />
				<span>购物车</span>
				</a>
			</span>
			<span class="foot_span">
				<a href="usercenter.html">
				<img src="images/foot6.png" />
				<span>我的</span>
				</a>
			</span>
		</div>
		
	
	<!--兑换的模态窗口-->
	<div class="mo" style="display: none;"></div>
       <div class="dui" style="display: none;">
       	   <div class="huan">
       	   	<span>兑换金额:</span>
       	   	<input type="number" id="val"/>
       	   	<div style="width: 90%;margin: auto;text-align: center;line-height: 29px;">标价类商品实付满<span id="jine">0</span>元可用</div>
       	   <div class="xian" style="line-height: 25px;position: relative;top: -10px;">本次兑换的抵用券有效期至<br><span id="yxq">2018-1-18</span></div>	   
       	   <div class="an">
       	   	<div class="que">
       	   	   <span>确定</span>
       	   	</div>
       	   	<div class="xiao">
       	   		<span>取消</span>
       	   	</div>
       	   </div>
       	   
       	   </div>
        </div>
        <!--返回结果的提示信息-->
		<div class="mo1" style="display: none;"></div>	
		<div id="dialog" style="display: none;">
			<div class="weui-mask"></div>
			<div class="weui-dialog" style="margin-bottom: 20px;"> 
				<div class="weui-dialog__hd" style="height: 20px;"><strong class="weui-dialog__title"></strong></div>
				<div class="weui-dialog__bd" id="warn_content"></div>
				<div class="weui-dialog__ft">
					<a href="javascript:;" id="confirm_btn" alerttype='0' class="weui-dialog__btn weui-dialog__btn_primary" style="background: url('{:ADDON_PUBLIC_PATH}/../Template/amy/images/anniu.png') no-repeat;background-size: 100% 100%;text-decoration: none;">确定</a>
				</div>
			</div>
		</div>
		
		
		
	</body>
	<script>
		/*总收益金*/
		var zsy = {$list_data.money};
		document.getElementById("zsyj").innerHTML=hlw(zsy);
		/*可兑换金额*/
		var js= {$list_data.total_amount};
		document.getElementById("js").innerHTML=hlw(js);
		/*已返还*/
		var yfh= {$list_data.back_amount};
		document.getElementById("yfh").innerHTML=hlw(yfh);
		/*剩余*/
		var sy= {$list_data.remain_amount};
		document.getElementById("sy").innerHTML=hlw(sy);
		/*每周返还*/
		var mz= {$list_data.day_amount};
		document.getElementById("mz").innerHTML=hlw(mz);
		/*循环数据的金额*/
		if(document.getElementsByClassName("xunrj") != undefined){
        var xunrj = document.getElementsByClassName("xunrj");		
		for(var i=0;i<xunrj.length;i++){
			xunrj[i].innerHTML=hlw(xunrj[i].innerHTML);
		}
		
		}
		var height=document.documentElement.clientHeight+"px";
		document.getElementsByClassName("mo")[0].style.height=height;
		document.getElementsByClassName("mo1")[0].style.height=height;
		var d = new Date();
        var str = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();
         Date.prototype.format = function(partten)
        {
            if(partten ==null||partten=='')
            {
                partten = 'y-m-d'    ;
            }
            var y = this.getYear();
            var m = this.getMonth()+1;
            var d = this.getDate();
            var r = partten.replace(/y+/gi,y);
            r = r.replace(/m+/gi,(m<10?"0":"")+m);
            r = r.replace(/d+/gi,(d<10?"0":"")+d);
            return r; 
        }
       
       var str1 = d.getFullYear()+"-"+new Date().format("m-d");

         document.getElementById("yxq").innerHTML=getNextMonth(str);
         $(function(){
         	$("#val").keyup(function(){
         		var val = accMul(this.value,3);
         		$("#jine").html(val);
         	})
         	/*点击我要兑换时*/
         	$(".pingjia").click(function(){
         		$(".mo").css("display","block");
         		$(".dui").css("display","block");
         	})
           /*点击取消时*/
          $(".xiao").click(function(){    
          	$(".mo").css("display","none");
         		$(".dui").css("display","none");
          })
          /*点击确定*/
         $(".que").click(function(){
         	//alert($("#val").val())
         	$.ajax({
         		type:"post",
         		url:"{:U('changeProfit')}",
         		async:true,
         		data:{"amount":$("#val").val()},
         		success:function(msg){
         			var msg = JSON.parse(msg)
         			tishi(msg[1],msg[0]);
         		}
         	});
         	
         })
         
         })
         $("#confirm_btn").click(function(){
         	if(this.getAttribute("alerttype")==1){
         		var jin = $("#val").val();
         		$("#dialog").css('display','none');
	      $(".mo1").css('display','none');
	      $(".dui").css('display','none');
	      $(".mo").css('display','none');
	      
	      var zsyj =accSub(parseFloat(document.getElementById("zsyj").innerHTML),parseFloat(jin));
	    //  alert(zsyj);
	      document.getElementById("zsyj").innerHTML=hlw(zsyj);
	      var div = document.createElement("div");
	      div.setAttribute("class","xun");
	      div.innerHTML='<div class="xunl">'+str1+'</div>'+
	                     '<div class="xunl">已兑换</div>'+ 
         		         '<div class="xunr">'+hlw($("#val").val())+'元</div>';
	      
	      document.getElementById("shuju").appendChild(div);

         	}else{
         		$("#dialog").css('display','none');
	      $(".mo1").css('display','none');
         	}
         })
         function tishi(obj,alerttype){
         	$("#warn_content").html(obj);
	      $("#dialog").css('display','block');
	      $(".mo1").css('display','block');
	      $("#confirm_btn").attr("alerttype",alerttype);
         }
       
		/*获取下一个月*/
		 function getNextMonth(date) {
            var arr = date.split('-');
            var year = arr[0]; //获取当前日期的年份
            var month = arr[1]; //获取当前日期的月份
            var day = arr[2]; //获取当前日期的日
            var days = new Date(year, month, 0);
            days = days.getDate(); //获取当前日期中的月的天数
            var year2 = year;
            var month2 = parseInt(month) + 1;
            if (month2 == 13) {
                year2 = parseInt(year2) + 1;
                month2 = 1;
            }
            var day2 = day;
            var days2 = new Date(year2, month2, 0);
            days2 = days2.getDate();
            if (day2 > days2) {
                day2 = days2;
            }
            if (month2 < 10) {
                month2 = '0' + month2;
            }
        
            var t2 = year2 + '-' + month2 + '-' + day2;
            return t2;
        }
		 
				/*加*/
function accAdd(arg1,arg2){
	var r1,r2,m;
	try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
	try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
	m=Math.pow(10,Math.max(r1,r2))
	return (arg1*m+arg2*m)/m
	}
	//给Number类型增加一个add方法，调用起来更加方便。
	Number.prototype.add = function (arg){
	return accAdd(arg,this);
}

//说明：javascript的减法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的减法结果。
//调用：accSub(arg1,arg2)
//返回值：arg1减上arg2的精确结果
/*减*/
function accSub(arg1,arg2){
	return accAdd(arg1,-arg2);
}
/*乘*/
function accMul(arg1,arg2){   
    arg1=String(arg1);var i=arg1.length-arg1.indexOf(".")-1;i=(i>=arg1.length)?0:i;   
    arg2=String(arg2);var j=arg2.length-arg2.indexOf(".")-1;j=(j>=arg2.length)?0:j;   
    return arg1.replace(".","")*arg2.replace(".","")/Math.pow(10,i+j);   
}
/*小数点后两位*/
function hlw(obj){
	var result=obj;
	if(result.toString().indexOf(".")==-1){
		result=result+".00";
	}else{
		var len = result.toString().length;
		var sj = len-result.toString().indexOf(".");
		if(sj==2){
			result=result+"0";
		}else{
			result=result.toString().substring(0,result.toString().indexOf(".")+3)+"";
		}
	}
	return result;
} 		

/*加0的日期*/
	  Date.prototype.format = function(partten)
        {
            if(partten ==null||partten=='')
            {
                partten = 'y-m-d'    ;
            }
            var y = this.getYear();
            var m = this.getMonth()+1;
            var d = this.getDate();
            var r = partten.replace(/y+/gi,y);
            r = r.replace(/m+/gi,(m<10?"0":"")+m);
            r = r.replace(/d+/gi,(d<10?"0":"")+d);
            return r; 
        }


	</script>
</html>
